/**
 * XYBASE Simple Data Grid, Extending a table as a data grid representation
 *
 * jQuery XYTable Plugins (Ported from xytable.js prototype version)
 *
 * jquery.xytable.js v1.0
 *
 * Developer: Imam Kurniawan <imam@xybase.com>
 * Copyright (c) 2010 XYBASE <http://www.xybase.com>
 */
(function($){$.fn.xytable=function(options){if(this.length===0){return this}var grid=$.data(this[0],'xytable');if(this.length==1&&grid){return grid}else{return this.each(function(){var id=$(this).attr('id'),opt=$.extend({id:id},options),xytable=new $.xytable(opt);$.data(this,'xytable',xytable);return xytable})}};$.xytable=function(options){this.settings=$.extend(true,{},$.xytable.defaults,options);this.table=$('#'+this.settings.id)[0];if($(this.table).find('tbody').length===0){$(this.table).append('<tbody/>')}this.Init()};$.extend(true,$.xytable,{defaults:{id:'xytable',width:0,fontSize:'0',header:true,mapToForm:true,mapOnCheck:false,highlight:true,highlightOnCheck:false,checkOnSelect:false,multiple:true,checkRow:true,rowCount:true,clearOnSelect:false,noSelect:false,rowMarking:[-1,0,1],rowAlternate:true,cursor:'pointer',emptyMsg:'No Data',contentControl:false,colModel:[],gridOp:'.',data:false,json:false,remote:false,hidedelete:false,hiddenIds:true,baseKey:'',callback:{onSelect:$.noop,onCheck:$.noop,onAdd:function(){return true},onUpdate:function(){return true},onDelete:function(){return true},onAfterShift:$.noop,onBeforeShift:function(){return true},onLoaded:$.noop},pager:{id:'pager',base:'',pos:'bottom',offset:0,page:1,total:1,records:1,max:5,rows:10,param:{},limitPages:true,showEdge:true,showSkip:false,showInactive:false,showInactiveNextPrev:false,ajax:false,callback:$.noop},sorter:false},messages:{'xytable.pager.info.tmpl':'Showing #{first}-#{last} of #{total}','xytable.pager.index.info':'Pages:','xytable.pager.index.first.title':'First Page','xytable.pager.index.first.label':'First','xytable.pager.index.last.title':'Last Page','xytable.pager.index.last.label':'Last','xytable.pager.index.next.title':'Next Page','xytable.pager.index.next.label':'Next','xytable.pager.index.prev.title':'Previous Page','xytable.pager.index.prev.label':'Previous','xytable.pager.index.skipnext.title':'Skip Next #{skip} pages','xytable.pager.index.skipnext.label':'Skip Next','xytable.pager.index.skipprev.title':'Skip Previous #{skip} pages','xytable.pager.index.skipprev.label':'Skip Prev','xytable.pager.index.page.title':'Page #{page}','xytable.pager.index.page.label':'#{page}','xytable.pager.index.current.title':'Current Page','xytable.pager.goto.label':'Go to:','xytable.remote.loading.label':'LOADING'},prototype:{Init:function(){var settings=this.settings;if(settings.colModel.length===0){throw"Please specify column model"}if(!settings.remote){this.DataInit();this.DOMInit();this.EventsInit();if(settings.callback.onLoaded){settings.callback.onLoaded.call(this,this.data)}}else{this.RemoteInit()}},RemoteInit:function(href,page,events){var settings=this.settings,xytable=this,table=$(xytable.table),url=href||settings.remote.url,type=settings.remote.type,ajaxOpts={url:url||'',type:'GET',data:{},cache:false,value:'',remote:true,dataType:type||'json',beforeSend:function(){$(table).find('tbody').html('<tr><td style="text-align:center;padding:5px 0;" colspan="0">'+$.xytable.messages['xytable.remote.loading.label']+'</td></tr>');if(settings.header){table.find('thead').remove()}},success:function(resp){if(type==='json'){var respData=resp[settings.remote.key||'data'];if(!respData){throw'Invalid json key!! key='+settings.remote.key}xytable.PopulateData(respData,true)}else{$(table).find('tbody').html(resp)}if(settings.sorter&&settings.sorter.remote){$.extend(true,settings,{sorter:{remote:{sortx:resp['sortx'],sortd:resp['sortd']}}})}if(settings.pager){$.extend(true,settings,{pager:{records:resp['records'],page:page||1}})}xytable.DataInit();xytable.DOMInit();if(events!==false){xytable.EventsInit()}if(settings.callback.onLoaded){settings.callback.onLoaded.call(xytable,xytable.data)}}};$.ajax($.extend(true,ajaxOpts,settings['ajaxOpts']))},DataInit:function(){var settings=this.settings,table=$(this.table),jsonObj,data=[],xytable=this,baseKey=settings.baseKey,gridOp=settings.gridOp,colModel=settings.colModel;if(settings.data){this.PopulateData(settings.data)}else if(settings.json&&$.parseJSON){jsonObj=$.parseJSON(settings.json);this.PopulateData(jsonObj.data)}$.each(table.find('tbody tr'),function(){var obj={},tr=$(this),d=tr.find('td').map(function(){return $(this).text()});$.each(d,function(i){var k=colModel[i].name;k=colModel[i].key?k+gridOp+colModel[i].key:k;obj[k]=this.toString()});data.push(obj)});this.data=data},DOMInit:function(){var i,head,style,colHeader='',label='',xytable=this,totalWidth=0,countWidth=0,offset=0,settings=this.settings,colModel=settings.colModel,gridId=settings.id,gridOp=settings.gridOp,table=$(this.table),baseKey=settings.baseKey,colSpan=1,rowSpan=1,rows=table.find('tbody tr'),visibleRows=table.find('tbody tr:visible'),idGroup,ids='',sorter=settings.sorter.remote||false,headerSorter={},headerSortDir=[];this.skip=0;this.skip+=settings.rowCount?1:0;this.skip+=settings.checkRow?1:0;if(settings.rowAlternate){table.find('tbody tr:odd').addClass('ui-xytable-alternate')}table.wrap('<div class="ui-xytable-wrapper" id="'+gridId+'-wrapper"></div>');if(settings.header){$.each(colModel,function(i){style='';if(this.width){style+='width:'+(!$.browser.safari?this.width:(this.width+15))+'px;'}if(this.hidden){style+='display:none;'}label=this.label||'Column'+(i+1);if(this['bindToCheck']){label+=(!label.empty()?'<br/>':'')+'<input type="checkbox" id="'+gridId+'-chk-all-col'+i+'"/>'}colHeader+='<th class="'+(this.align||'')+' "style="'+style+'" _idx="'+i+'">'+label+'</th>';totalWidth+=this.width||0;if(sorter){headerSortDir[i]=sorter.sortx&&this.name==sorter.sortx?sorter.sortd:1}});totalWidth=(settings.width&&settings.width>totalWidth)?settings.width:totalWidth;if(totalWidth>0){totalWidth+=(this.skip*25);table.addClass('ui-xytable').attr('width',totalWidth)}else{table.addClass('ui-xytable').attr('width','100%')}table.prepend('<thead><tr></tr></thead>').find('thead tr').append(colHeader).addClass('ui-xytable-header');this.headerSortDir=headerSortDir}else{head=table.find('thead');rowSpan=head.find('tr').length;if(head.length>0){head.find('tr').addClass('ui-xytable-header')}}this.thead=table.find('thead');this.tbody=table.find('tbody');this.pager=$('#'+settings.pager.id);this.wrapper=$('#'+gridId+'-wrapper');if(totalWidth>0){this.pager.css({'width':'98%'})}if(this.pager.length>0&&this.data.length>0){if(settings.pager.pos==='bottom'){this.wrapper.append(this.pager);if($.browser['msie']){this.wrapper.append('<div class="after-pager-ie-workaround"></div>')}}else{this.wrapper.prepend(this.pager)}}rows.each(function(i){var tr=$(this),tds=tr.find('td'),nameGetter=function(name,base){return baseKey?name.replace(baseKey+gridOp,''):base?name.replace(base+gridOp,''):name};tr.attr('_idx',i);$.each(colModel,function(i){var td=$(tds[i]);if(this.hidden){td.hide()}if(this.id){var name=nameGetter(this.name,this.base);ids+='<input type="hidden" name="'+name+'" value="'+td.text()+'"/>';td.attr('rel','id')}if(this.align){switch(this.align){case'right':case'left':case'center':td.addClass(this.align);break}}})});if(settings.hiddenIds){idGroup=$('.ui-xytable-ids',this.wrapper);if(idGroup.length==0){this.wrapper.append('<div class="ui-xytable-ids" style="display:none;">'+ids+'</div>')}else{idGroup.html(ids)}}if(this.pager.length>0){this.PagerInit()}if(settings.rowCount){offset=parseInt(settings.pager.offset,10);countWidth=offset>999?($.browser.safari?45:35):0;this.thead.find('tr').prepend('<th class="count center" rowSpan="'+rowSpan+'">No.</th>');if(countWidth>0){$(this.thead.find('th.count').get(0)).css({'width':countWidth})}visibleRows.each(function(i){var count=i+1;if(offset){count+=offset}$(this).prepend('<td class="count center">'+count+'.</td>')})}if(settings.multiple&&settings.checkRow){this.thead.find('tr').prepend('<th class="check center" rowSpan="'+rowSpan+'"><input type="checkbox" id="'+gridId+'-chk-all" class="ui-xytable-control"/></th>');rows.each(function(i){var tr=$(this),idTd=tr.find('td[rel=id]'),idValue=idTd.length>0?idTd.text():(i+1);tr.prepend('<td class="check center"><input type="checkbox" class="ui-xytable-control" name="'+gridId+'ChkList" value="'+idValue+'"/></td>')})}else if(settings.checkRow){this.thead.find('tr').prepend('<th class="radio" rowSpan="'+rowSpan+'">&nbsp;</th>');rows.each(function(i){var tr=$(this),idTd=tr.find('td[rel=id]'),idValue=idTd.length>0?idTd.val():(i+1);tr.prepend('<td class="radio center"><input type="radio" name="'+gridId+'Rdo" value="'+idValue+'"/></td>')})}if(rows.length===0){this.PutEmptyMsg()}else{rows.each(function(i){this._idx=i})}if(settings.fontSize&&settings.fontSize!==''&&settings.fontSize!=='0'){this.thead.parents('table').find('th, td').css({'font-size':settings.fontSize})}if(settings.sorter&&rows.length>1&&!settings.sorter.remote){for(i=0;i<this.skip;i++){headerSorter[i]={sorter:false}}sorter=$.extend(true,{headers:headerSorter},settings.sorter);table.tablesorter(sorter)}else if(settings.sorter.remote&&rows.length>1){$.each(this.thead.find('th'),function(i){if(i>=xytable.skip){$(this).addClass('header')}});if(sorter.sortx&&sorter.sortx!=='null'){$.each(colModel,function(i){var th=$(xytable.thead.find('th')[i+xytable.skip]);if(this.name===sorter.sortx){th.addClass(sorter.sortd==1?'headerSortUp':'headerSortDown')}})}}},EventsInit:function(){var xytable=this,settings=xytable.settings,table=$(this.table),data=xytable.data,mapToForm=$.noop,selectCheckRow=$.noop,clickCheck=$.noop;mapToForm=function(row){var colModel=settings.colModel;$(row).find('td').each(function(i,c){if(i<xytable.skip){return}var elt,idx=i-xytable.skip,v=$(c).text(),eltId=(colModel[idx])['field'];if(eltId&&eltId!==''){elt=$('#'+eltId);if(elt.length===0&&/\./.test(eltId)){elt=$('input').map(function(){if(this.name===eltId){return this}})}else if(elt.length===0){elt=$(':input[name="'+eltId+'"]')}if(elt.is(':checkbox')){elt[0].checked=v==='Y'||v==='true'||v==='1'}else if(elt.length>=1&&$(elt[0]).is(':radio')){elt.each(function(){this.checked=$(this).val()==v})}else if(elt.is('select')){elt.val(v.split(','))}else{elt.val(v)}}})};clickCheck=function(elt,row,call){var raw=elt.get(0),check=false,checked=0,rows=0,idx=row.attr('_idx');if(elt.is(':checkbox[id$=chk-all].ui-xytable-control')){check=elt.get(0).checked;row.parents('table').find(':checkbox.ui-xytable-control').each(function(i){this.checked=check;if(settings.highlight&&settings.highlightOnCheck){xytable.Highlight.call(raw,i,check,true)}});settings.callback.onCheck.call(xytable,check,data,-1)}else{if(settings.mapToForm&&settings.mapOnCheck){mapToForm.call(raw,row.get(0))}if(settings.highlight&&settings.highlightOnCheck){xytable.Highlight.call(raw,idx,raw.checked,true)}if(elt.is(':checkbox')){rows=row.parents('tbody').find('tr').length;checked=elt.parents('tbody').find(':checkbox.ui-xytable-control[checked]').length;elt.parents('table').find('thead :checkbox.ui-xytable-control').get(0).checked=(checked==rows)}if(call===true){settings.callback.onCheck.call(xytable,checked>0,data[parseInt(idx,10)],idx)}}};selectCheckRow=function(e){var idx,check,elt=$(e.target),remoteSorting=elt.is('th')&&settings.sorter.remote,thIdx=0,sortx,sortd,sortHref=remoteSorting?sortForm?$(sortForm).attr('action'):settings.sorter.remote.href:'',sortForm=remoteSorting?settings.sorter.remote.form:'',row=elt.is('td')||elt.is(':checkbox')?elt.parents('tr'):elt,gridOp=settings.gridOp,_sortHref=sortHref+(sortHref.indexOf('?')!=-1?'&':'?')+'#{gridId}#{gridOp}sortx=#{sortx}&#{gridId}#{gridOp}sortd=#{sortd}';idx=row.attr('_idx');if(elt.is(':checkbox')){clickCheck(elt,row,true)}else if(remoteSorting){thIdx=parseInt(elt.attr('_idx'),10);sortd=xytable.headerSortDir[thIdx]=xytable.headerSortDir[thIdx]*-1;sortx=settings.colModel[thIdx].name;sortHref=$.tmpl(_sortHref,{sortx:sortx,sortd:sortd,gridId:settings.id,gridOp:gridOp});elt.addClass(sortd==1?'headerSortUp':'headerSortDown');elt.removeClass(sortd==1?'headerSortDown':'headerSortUp');if(settings.remote){xytable.RemoteInit(sortHref,null,false)}else if(sortForm){$(sortForm).attr('action',sortHref).submit()}else{location.href=sortHref}}else{if(settings.mapToForm){mapToForm.call(elt.get(0),row)}if(settings.highlight&&!elt.is('th')){xytable.Highlight.call(elt.get(0),idx,true,settings.checkOnSelect)}if(settings.clearOnSelect){xytable.ClearCheck()}else if(settings.checkRow&&settings.checkOnSelect){check=elt.parents('tr').find(':checkbox.ui-xytable-control');check.get(0).checked=true;clickCheck(check,row)}settings.callback.onSelect.call(xytable,xytable.data[parseInt(idx,10)],idx)}};$('#'+settings.id).live('click','td, th',selectCheckRow);if(settings.sorter&&!settings.sorter.remote){table.bind("sortEnd",function(){var table=$(this.table);table.find('tbody tr.ui-xytable-alternate').removeClass('ui-xytable-alternate');table.find('tbody tr:odd').addClass('ui-xytable-alternate');table.find('tbody tr').each(function(i,tr){var count=i+1;if(settings.rowCount){$(tr).find('td.count').text(count+'.')}})})}},PagerInit:function(){var i,x,y,lower,higher,prop,settings=this.settings,hide=false,gotoStr='',infoStr='',links='',paramIsEmpty=true,opts=settings.pager,xytable=this,link_tmpl='<a href="#{href}" title="#{title}" class="#{clazz}" page="#{page}">#{text}</a>',info_tmpl=$.xytable.messages['xytable.pager.info.tmpl'],gridOp=settings.gridOp,container=$('#'+opts.id),paramPos=opts.base.indexOf('?'),url,baseParam=paramPos!==-1?$.deparam(opts.base.substr(paramPos+1,opts.base.length)):{},param=$.extend({},opts.param,baseParam);for(prop in opts.param){if(opts.param.hasOwnProperty(prop)){paramIsEmpty=false}}if(settings.sorter&&settings.sorter.remote&&settings.sorter.remote.sortx){param[settings.id+gridOp+'sortx']=settings.sorter.remote.sortx;param[settings.id+gridOp+'sortd']=settings.sorter.remote.sortd}param[settings.id+gridOp+'offset']='';url=(paramIsEmpty?'':opts.base)+opts.base.substr(0,paramPos!==-1?paramPos:opts.base.length)+'?'+$.param(param);opts.page=parseInt(opts.page,10);opts.records=parseInt(opts.records,10);opts.offset=(opts.page*opts.rows)-opts.rows;opts.total=Math.ceil(opts.records/opts.rows);x=1;y=opts.total>opts.max&&opts.limitPages?opts.max:opts.total;if((opts.total>opts.max)&&opts.limitPages){lower=opts.page-Math.floor(opts.max/2);higher=opts.page+Math.floor(opts.max/2);if(lower>0&&opts.total>opts.max){x=lower}if(higher>opts.total-1){x=x-(higher-opts.total)}if(higher<opts.total&&higher>opts.max&&opts.total>opts.max){y=opts.max%2!==0?higher:higher-1}else if(higher>opts.total-1){y=opts.total}}if(opts.page!=1&&opts.showEdge){links+=$.tmpl(link_tmpl,{href:url+'0',clazz:'pager-link nav',title:$.xytable.messages['xytable.pager.index.first.title'],text:$.xytable.messages['xytable.pager.index.first.label'],page:1})}else if(opts.showEdge){links+=$.tmpl(link_tmpl,{href:'#',clazz:'pager-link nav edge inactive',title:$.xytable.messages['xytable.pager.index.first.title'],text:$.xytable.messages['xytable.pager.index.first.label'],page:1})}if((opts.page-opts.max)>0&&opts.showSkip){links+=$.tmpl(link_tmpl,{href:url+(opts.offset-(opts.rows*opts.max)),clazz:'pager-link nav',title:$.tmpl($.xytable.messages['xytable.pager.index.skipprev.title'],{skip:opts.max}),text:$.tmpl($.xytable.messages['xytable.pager.index.skipprev.label'],{skip:opts.max}),page:opts.page-opts.max})}else if(opts.showSkip){links+=$.tmpl(link_tmpl,{href:'#',clazz:'pager-link nav inactive',title:$.tmpl($.xytable.messages['xytable.pager.index.skipprev.title'],{skip:opts.max}),text:$.tmpl($.xytable.messages['xytable.pager.index.skipprev.label'],{skip:opts.max}),page:0})}if(opts.page>1){links+=$.tmpl(link_tmpl,{href:url+(opts.offset-opts.rows),clazz:'pager-link nav',title:$.xytable.messages['xytable.pager.index.prev.title'],text:$.xytable.messages['xytable.pager.index.prev.label'],page:opts.page-1})}else{links+=$.tmpl(link_tmpl,{href:'#',clazz:'pager-link nav nextprev inactive',title:$.xytable.messages['xytable.pager.index.prev.title'],text:$.xytable.messages['xytable.pager.index.prev.label'],page:0})}if(y>1){links+='&nbsp;<span>'+$.xytable.messages['xytable.pager.index.info']+'</span>&nbsp;'}for(i=x;i<=y;i++){links+=$.tmpl(link_tmpl,{href:url+((i-1)*opts.rows),clazz:opts.page===i?'pager-link current inactive':'pager-link',title:opts.page===i?$.xytable.messages['xytable.pager.index.current.title']:$.tmpl($.xytable.messages['xytable.pager.index.page.title'],{page:i}),text:$.tmpl($.xytable.messages['xytable.pager.index.page.label'],{page:i}),page:i})}if(opts.page<opts.total){links+=$.tmpl(link_tmpl,{href:url+(opts.offset+opts.rows),clazz:'pager-link nav',title:$.xytable.messages['xytable.pager.index.next.title'],text:$.xytable.messages['xytable.pager.index.next.label'],page:opts.page+1})}else{links+=$.tmpl(link_tmpl,{href:'#',clazz:'pager-link nav nextprev inactive',title:$.xytable.messages['xytable.pager.index.next.title'],text:$.xytable.messages['xytable.pager.index.next.label'],page:0})}if((opts.page+opts.max)<opts.total&&opts.showSkip){links+=$.tmpl(link_tmpl,{href:url+(opts.offset+(opts.rows*opts.max)),clazz:'pager-link nav',title:$.tmpl($.xytable.messages['xytable.pager.index.skipnext.title'],{skip:opts.max}),text:$.tmpl($.xytable.messages['xytable.pager.index.skipnext.label'],{skip:opts.max}),page:opts.page+opts.max})}else if(opts.showSkip){links+=$.tmpl(link_tmpl,{href:'#',clazz:'pager-link nav inactive',title:$.tmpl($.xytable.messages['xytable.pager.index.skipnext.title'],{skip:opts.max}),text:$.tmpl($.xytable.messages['xytable.pager.index.skipnext.label'],{skip:opts.max}),page:0})}if(opts.page!=opts.total&&opts.showEdge){links+=$.tmpl(link_tmpl,{href:url+(opts.rows*(opts.total-1)),clazz:'pager-link nav',title:$.xytable.messages['xytable.pager.index.last.title'],text:$.xytable.messages['xytable.pager.index.last.label'],page:opts.total})}else if(opts.showEdge){links+=$.tmpl(link_tmpl,{href:'#',clazz:'pager-link nav edge inactive',title:$.xytable.messages['xytable.pager.index.last.title'],text:$.xytable.messages['xytable.pager.index.last.label'],page:0})}infoStr=$.tmpl(info_tmpl,{first:opts.offset+1,last:opts.records>opts.offset+opts.rows?opts.offset+opts.rows:opts.records,total:opts.records,pages:opts.total});container.html('');container.addClass('ui-xytable-pager');container.append('<div class="info">'+infoStr+'</div>');container.append('<div class="index">'+links+'</div>');container.find('a.inactive:not(.current)').hide();if(opts.showInactive){container.find('a.inactive').show()}else if(opts.showInactiveNextPrev){container.find('a.nextprev.inactive').show()}if(opts['goto']){gotoStr=$.xytable.messages['xytable.pager.goto.label']+'&nbsp;<input type="text" class="field goto" id="'+settings.id+'Goto"/>';container.find('.index').append(gotoStr);$('#'+settings.id+'Goto').keyup(function(e){var val,ch=String.fromCharCode(e.keyCode);if(!/[\d]/.test(ch)&&e.keyCode!==13){if(!/[\d]/.test(ch)){$(this).val($(this).val().substr(0,$(this).val().length-1))}}if(e.keyCode===13){val=$(this).val()>opts.total?opts.total:val;url+=(val*opts.rows)-opts.rows;if(opts.ajax){xytable.RemoteInit(this.href,val)}else{location.href=url}}})}container.find('a.pager-link').click(function(){var page=parseInt($(this).attr('page'),10);if($(this).is('.inactive')){return false}if(opts.ajax){xytable.RemoteInit(this.href,page,false);return false}else if(opts.form){$('#'+opts.form).attr('action',this.href);$('#'+opts.form).trigger('submit');return false}});hide=this.data.length===0||opts.records<=opts.rows;container[hide?'hide':'show']()},Highlight:function(idx,isOn,noClear){var table=$(this).parents('table'),xytable=table.xytable(),row=table.find('tbody tr').get(idx);if(!idx){return}if(!noClear){xytable.ClearHighlight()}$(row)[isOn===true?'addClass':'removeClass']('ui-xytable-highlight')},ClearCheck:function(){$(this.table).find(':checkbox.ui-xytable-control').each(function(){this.checked=false})},ClearHighlight:function(){$(this.table).find('.ui-xytable-highlight').removeClass('ui-xytable-highlight')},DisableCheck:function(){$(this.table).find(':checkbox..ui-xytable-control, :radio.ui-xytable-control').each(function(){this.disabled=true})},EnableCheck:function(){$(this.table).find(':checkbox..ui-xytable-control, :radio.ui-xytable-control').each(function(){this.disabled=false})},ShiftRowUp:function(){var settings=this.settings,selected=$(this.table).find('tbody tr:visible').map(function(){if($(this).find(':checkbox.ui-xytable-control').get(0).checked){return this}});if(settings.callback.onBeforeShift.call(this,selected)){this.ShiftRow('up',selected);settings.callback.onAfterShift.call(this,'up',selected)}},ShiftRowDown:function(){var settings=this.settings,selected=$(this.table).find('tbody tr:visible').map(function(){if($(this).find(':checkbox.ui-xytable-control').get(0).checked){return this}});if(settings.callback.onBeforeShift.call(this,selected)){this.ShiftRow('down',selected);settings.callback.onAfterShift.call(this,'down',selected)}},ShiftRow:function(dir,selected){var settings=this.settings,table=$(this.table);if(dir==='up'){$.each(selected,function(){var visibleRows=$(this).prevAll(':visible');if(visibleRows.length>0){$(visibleRows[0]).before(this)}else{return false}})}else if(dir==='down'){selected=$.makeArray(selected).reverse();$.each(selected,function(){var visibleRows=$(this).nextAll(':visible');if(visibleRows.length>0){$(visibleRows[0]).after(this)}else{return false}})}table.find('tbody tr.ui-xytable-alternate').removeClass('ui-xytable-alternate');table.find('tbody tr:odd').addClass('ui-xytable-alternate');table.find('tbody tr').each(function(i,r){var count=i+1;if(settings.rowCount){$(r).find('td.count').text(count+'.')}})},SetEmptyMsg:function(msg){var settings=this.settings;if(this.data.length===0){if(msg){settings.emptyMsg=msg}$(this.table).find('tbody td').text(settings.emptyMsg)}},PutEmptyMsg:function(){var settings=this.settings;colSpan=$('th',this.thead).length;this.tbody.append('<tr class="ui-xytable-empty-row"><td colSpan="'+colSpan+'">'+settings.emptyMsg+'</td></tr>');this.DisableCheck()},PopulateData:function(data,noMerge){var rows='',settings=this.settings,table=$(this.table),colModel=settings.colModel;if(!(noMerge||false)){this.data=$.merge(this.data,data)}else{this.data=data}$.each(this.data,function(){var row=this,td='';$.each(colModel,function(){var keys=[],name=this.name,text=row[name]!==undefined?row[name]:'--error--';if(this.key&&!this.key.empty()){keys=this.key.split('.');$.each(keys,function(){text=text[this]})}td+='<td>'+text+'</td>'});rows+='<tr '+(this.hide?'style="display:none;"':'')+'>'+td+'</tr>'});table.find('tbody').html(rows);if(!settings.remote){if(settings.header){table.find('thead').remove()}this.DataInit();this.DOMInit()}},AddRow:function(data){var callback=this.settings.callback;if(!(data instanceof Array)){data=[data]}if(callback.onAdd()){this.PopulateData(data)}},UpdateRow:function(newData,formSer){var data=this.data,skip=this.skip,tbody=this.tbody,settings=this.settings,colModel=settings.colModel,callback=settings.callback,baseKey=settings.baseKey,gridOp=settings.gridOp,idx=-1,id='',row,nameGetter=function(name,base){return baseKey?name.replace(baseKey+gridOp,''):base?name.replace(base+gridOp,''):name},idKey=$.map(colModel,function(x){if(x.id===true){return nameGetter(x.name,x.base)}});if(idKey.length==0){return false}if(callback.onUpdate()){id=idKey[0];$.each(data,function(i){if(data[i][id]==newData[id]){idx=i;data[i]=newData}});if(idx===-1){throw'No Rows Matched'}row=$('tr:eq('+idx+')',tbody);$.each(colModel,function(i){var text,colIdx=i+skip,keys=[],name=nameGetter(this.name,this.base);name=formSer&&this.key?name+gridOp+this.key:name;text=newData[name]!==undefined?newData[name]:'--error--';if(!formSer&&this.key&&!this.key.empty()){keys=this.key.split('.');$.each(keys,function(){text=text[this]})}$('td:eq('+colIdx+')',row).text(text)})}},DeleteRow:function(rowIdx){var newData=[],settings=this.settings,hide=settings.hidedelete,callback=settings.callback;if(typeof rowIdx=='undefined'){rowIdx=$(this.table).find('tbody tr').map(function(i){if(!$(this).is(':visible')){return i}if($(this).find(':checkbox.ui-xytable-control').get(0).checked){return i}});rowIdx=$.map(rowIdx,function(x){return x})}if(!(rowIdx instanceof Array)){rowIdx=[rowIdx]}$.each(this.data,function(i){if($.inArray(i,rowIdx)===-1){newData.push(this)}else if(hide){this.hide=true;newData.push(this)}});if(callback.onDelete()&&rowIdx.length>0){this.PopulateData(newData,true)}return rowIdx},DeleteAll:function(){var settings=this.settings,tbody=this.tbody,rows=$('tr',tbody);rows=$.map(rows,function(tr,i){return i});this.DeleteRow(rows);if(settings.remote){this.PutEmptyMsg();$.extend(true,settings.pager,{offset:0,page:1,total:1,records:1});this.PagerInit()}},Reload:function(){var settings=this.settings;if(!settings.remote){return}this.RemoteInit(settings.remote.url,false,false)},Serialize:function(name){var i=0,data=this.data,arr=[],dataKeys={},settings=this.settings,gridOp=settings.gridOp,colModel=settings.colModel,baseKey=settings['baseKey'];$.each(colModel,function(){dataKeys[this.name]=this.key});$.each(data,function(){var row=this,val='',obj={};if(name){arr.push(row[name].toString())}else{$.each(row,function(key){key=baseKey?baseKey+gridOp+key:key;key=dataKeys[key]?key+gridOp+dataKeys[key]:key;obj[key]=this.toString()});arr.push(obj)}});return arr}}})})(jQuery);